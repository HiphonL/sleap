
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>sleap.gui.app &#8212; SLEAP  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for sleap.gui.app</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main GUI application for labeling, training/inference, and proofreading.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">PySide2</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PySide2.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QEvent</span>

<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QDockWidget</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QGroupBox</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QComboBox</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QMessageBox</span>

<span class="kn">from</span> <span class="nn">sleap.skeleton</span> <span class="kn">import</span> <span class="n">Skeleton</span>
<span class="kn">from</span> <span class="nn">sleap.instance</span> <span class="kn">import</span> <span class="n">Instance</span>
<span class="kn">from</span> <span class="nn">sleap.io.dataset</span> <span class="kn">import</span> <span class="n">Labels</span>
<span class="kn">from</span> <span class="nn">sleap.info.summary</span> <span class="kn">import</span> <span class="n">StatisticSeries</span>
<span class="kn">from</span> <span class="nn">sleap.gui.commands</span> <span class="kn">import</span> <span class="n">CommandContext</span><span class="p">,</span> <span class="n">UpdateTopic</span>
<span class="kn">from</span> <span class="nn">sleap.gui.widgets.video</span> <span class="kn">import</span> <span class="n">QtVideoPlayer</span>
<span class="kn">from</span> <span class="nn">sleap.gui.widgets.slider</span> <span class="kn">import</span> <span class="n">set_slider_marks_from_labels</span>
<span class="kn">from</span> <span class="nn">sleap.gui.dataviews</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GenericTableView</span><span class="p">,</span>
    <span class="n">VideosTableModel</span><span class="p">,</span>
    <span class="n">SkeletonNodesTableModel</span><span class="p">,</span>
    <span class="n">SkeletonEdgesTableModel</span><span class="p">,</span>
    <span class="n">SuggestionsTableModel</span><span class="p">,</span>
    <span class="n">LabeledFrameTableModel</span><span class="p">,</span>
    <span class="n">SkeletonNodeModel</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">sleap.gui.dialogs.filedialog</span> <span class="kn">import</span> <span class="n">FileDialog</span>
<span class="kn">from</span> <span class="nn">sleap.gui.dialogs.formbuilder</span> <span class="kn">import</span> <span class="n">YamlFormWidget</span>
<span class="kn">from</span> <span class="nn">sleap.gui.shortcuts</span> <span class="kn">import</span> <span class="n">Shortcuts</span>
<span class="kn">from</span> <span class="nn">sleap.gui.dialogs.shortcuts</span> <span class="kn">import</span> <span class="n">ShortcutDialog</span>
<span class="kn">from</span> <span class="nn">sleap.gui.state</span> <span class="kn">import</span> <span class="n">GuiState</span>
<span class="kn">from</span> <span class="nn">sleap.gui.overlays.tracks</span> <span class="kn">import</span> <span class="n">TrackTrailOverlay</span><span class="p">,</span> <span class="n">TrackListOverlay</span>
<span class="kn">from</span> <span class="nn">sleap.gui.color</span> <span class="kn">import</span> <span class="n">ColorManager</span>
<span class="kn">from</span> <span class="nn">sleap.gui.overlays.instance</span> <span class="kn">import</span> <span class="n">InstanceOverlay</span>

<span class="kn">from</span> <span class="nn">sleap.prefs</span> <span class="kn">import</span> <span class="n">prefs</span>


<div class="viewcode-block" id="MainWindow"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow">[docs]</a><span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The SLEAP GUI application.</span>

<span class="sd">    Each project (`Labels` dataset) that you have loaded in the GUI will</span>
<span class="sd">    have its own `MainWindow` object.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        labels: The :class:`Labels` dataset. If None, a new, empty project</span>
<span class="sd">            (i.e., :class:`Labels` object) will be created.</span>
<span class="sd">        state: Object that holds GUI state, e.g., current video, frame,</span>
<span class="sd">            whether to show node labels, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the app.</span>

<span class="sd">        Args:</span>
<span class="sd">            labels_path: Path to saved :class:`Labels` dataset.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">GuiState</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">Labels</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span> <span class="n">CommandContext</span><span class="p">(</span>
            <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_data_update</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buttons</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_child_windows</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Skeleton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labeled_frame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;show labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;show edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;edge style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;fit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;color predicted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prefs</span><span class="p">[</span><span class="s2">&quot;color predicted&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_gui</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">labels_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadProjectFile</span><span class="p">(</span><span class="n">labels_path</span><span class="p">)</span>

<div class="viewcode-block" id="MainWindow.setWindowTitle"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.setWindowTitle">[docs]</a>    <span class="k">def</span> <span class="nf">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets window title (if value is not None).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">MainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.event"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.event">[docs]</a>    <span class="k">def</span> <span class="nf">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">QEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Custom event handler.</span>

<span class="sd">        We use this to ignore events that would clear status bar.</span>

<span class="sd">        Args:</span>
<span class="sd">            e: The event.</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if we ignore event, otherwise returns whatever the usual</span>
<span class="sd">            event handler would return.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QEvent</span><span class="o">.</span><span class="n">StatusTip</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">tip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.closeEvent"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes application window, prompting for saving as needed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;has_changes&quot;</span><span class="p">]:</span>
            <span class="c1"># No unsaved changes, so accept event (close)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msgBox</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msgBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Do you want to save the changes to this project?&quot;</span><span class="p">)</span>
            <span class="n">msgBox</span><span class="o">.</span><span class="n">setInformativeText</span><span class="p">(</span><span class="s2">&quot;If you don&#39;t save, your changes will be lost.&quot;</span><span class="p">)</span>
            <span class="n">msgBox</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span>
                <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Save</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Discard</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span>
            <span class="p">)</span>
            <span class="n">msgBox</span><span class="o">.</span><span class="n">setDefaultButton</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Save</span><span class="p">)</span>

            <span class="n">ret_val</span> <span class="o">=</span> <span class="n">msgBox</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">ret_val</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">:</span>
                <span class="c1"># cancel close by ignoring event</span>
                <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">ret_val</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Discard</span><span class="p">:</span>
                <span class="c1"># don&#39;t save, just close</span>
                <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">ret_val</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Save</span><span class="p">:</span>
                <span class="c1"># save</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">saveProject</span><span class="p">()</span>
                <span class="c1"># accept event (closes window)</span>
                <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>

    <span class="nd">@labels</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_initialize_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates menus, dock windows, starts timers to update gui state.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_color_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_video_player</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_menus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_dock_windows</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_overlays</span><span class="p">()</span>

        <span class="c1"># Create timer to update state of gui at regular intervals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_gui_timer</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_gui_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_gui_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_gui_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_video_player</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and connects :class:`QtVideoPlayer` for gui.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">QtVideoPlayer</span><span class="p">(</span>
            <span class="n">color_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">changedPlot</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_after_plot_update</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">instanceDoubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doubleClickInstance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">selectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateStatusMessage</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">switch_frame</span><span class="p">(</span><span class="n">video</span><span class="p">):</span>
            <span class="c1"># Jump to last labeled frame</span>
            <span class="n">last_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">find_last</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">last_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_label</span><span class="o">.</span><span class="n">frame_idx</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">switch_frame</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateSeekbarMarks</span><span class="p">()]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_color_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span> <span class="o">=</span> <span class="n">ColorManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;palette&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;standard&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_menus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates main application menus.&quot;&quot;&quot;</span>
        <span class="n">shortcuts</span> <span class="o">=</span> <span class="n">Shortcuts</span><span class="p">()</span>

        <span class="c1"># add basic menu item</span>
        <span class="k">def</span> <span class="nf">add_menu_item</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
            <span class="n">menu_item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">shortcuts</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">menu_item</span>

        <span class="c1"># set menu checkmarks</span>
        <span class="k">def</span> <span class="nf">connect_check</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">)</span>

        <span class="c1"># add checkable menu item connected to state variable</span>
        <span class="k">def</span> <span class="nf">add_menu_check_item</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">add_menu_item</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">toggle</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="n">connect_check</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="c1"># check and uncheck submenu items</span>
        <span class="k">def</span> <span class="nf">_menu_check_single</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">item_text</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Helper method to select exactly one submenu item.&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">menu_item</span> <span class="ow">in</span> <span class="n">menu</span><span class="o">.</span><span class="n">children</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">menu_item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">item_text</span><span class="p">):</span>
                    <span class="n">menu_item</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">menu_item</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># add submenu with checkable items</span>
        <span class="k">def</span> <span class="nf">add_submenu_choices</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="n">submenu</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_menu_check_single</span><span class="p">(</span><span class="n">submenu</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">submenu_item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">option</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="n">option</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">submenu_item</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="c1">### File Menu ###</span>

        <span class="n">fileMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span><span class="n">fileMenu</span><span class="p">,</span> <span class="s2">&quot;new&quot;</span><span class="p">,</span> <span class="s2">&quot;New Project&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">newProject</span><span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span><span class="n">fileMenu</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;Open Project...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">openProject</span><span class="p">)</span>

        <span class="n">import_types_menu</span> <span class="o">=</span> <span class="n">fileMenu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;Import...&quot;</span><span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">import_types_menu</span><span class="p">,</span>
            <span class="s2">&quot;import_coco&quot;</span><span class="p">,</span>
            <span class="s2">&quot;COCO dataset...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">importCoco</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">import_types_menu</span><span class="p">,</span>
            <span class="s2">&quot;import_dlc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DeepLabCut dataset...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">importDLC</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">import_types_menu</span><span class="p">,</span>
            <span class="s2">&quot;import_dpk&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DeepPoseKit dataset...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">importDPK</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">import_types_menu</span><span class="p">,</span>
            <span class="s2">&quot;import_leap&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LEAP Matlab dataset...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">importLEAP</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">import_types_menu</span><span class="p">,</span>
            <span class="s2">&quot;import_analysis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SLEAP Analysis HDF5...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">importAnalysisFile</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">fileMenu</span><span class="p">,</span>
            <span class="s2">&quot;import predictions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Merge into Project...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">importPredictions</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">fileMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="n">add_menu_item</span><span class="p">(</span><span class="n">fileMenu</span><span class="p">,</span> <span class="s2">&quot;add videos&quot;</span><span class="p">,</span> <span class="s2">&quot;Add Videos...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">addVideo</span><span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">fileMenu</span><span class="p">,</span> <span class="s2">&quot;replace videos&quot;</span><span class="p">,</span> <span class="s2">&quot;Replace Videos...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">replaceVideo</span>
        <span class="p">)</span>

        <span class="n">fileMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="n">add_menu_item</span><span class="p">(</span><span class="n">fileMenu</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">saveProject</span><span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span><span class="n">fileMenu</span><span class="p">,</span> <span class="s2">&quot;save as&quot;</span><span class="p">,</span> <span class="s2">&quot;Save As...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">saveProjectAs</span><span class="p">)</span>

        <span class="n">fileMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">fileMenu</span><span class="p">,</span>
            <span class="s2">&quot;export analysis&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Export Analysis HDF5...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">exportAnalysisFile</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">fileMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="n">add_menu_item</span><span class="p">(</span><span class="n">fileMenu</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>

        <span class="c1">### Go Menu ###</span>

        <span class="n">goMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;Go&quot;</span><span class="p">)</span>

        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">goMenu</span><span class="p">,</span>
            <span class="s2">&quot;goto next labeled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Next Labeled Frame&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">nextLabeledFrame</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">goMenu</span><span class="p">,</span>
            <span class="s2">&quot;goto prev labeled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Previous Labeled Frame&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">previousLabeledFrame</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">goMenu</span><span class="p">,</span>
            <span class="s2">&quot;goto next user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Next User Labeled Frame&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">nextUserLabeledFrame</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">goMenu</span><span class="p">,</span>
            <span class="s2">&quot;goto next suggestion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Next Suggestion&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">nextSuggestedFrame</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">goMenu</span><span class="p">,</span>
            <span class="s2">&quot;goto prev suggestion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Previous Suggestion&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">prevSuggestedFrame</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">goMenu</span><span class="p">,</span>
            <span class="s2">&quot;goto next track spawn&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Next Track Spawn Frame&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">nextTrackFrame</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">goMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">next_vid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">increment_in_list</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">prev_vid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">increment_in_list</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">add_menu_item</span><span class="p">(</span><span class="n">goMenu</span><span class="p">,</span> <span class="s2">&quot;next video&quot;</span><span class="p">,</span> <span class="s2">&quot;Next Video&quot;</span><span class="p">,</span> <span class="n">next_vid</span><span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span><span class="n">goMenu</span><span class="p">,</span> <span class="s2">&quot;prev video&quot;</span><span class="p">,</span> <span class="s2">&quot;Previous Video&quot;</span><span class="p">,</span> <span class="n">prev_vid</span><span class="p">)</span>

        <span class="n">goMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="n">add_menu_item</span><span class="p">(</span><span class="n">goMenu</span><span class="p">,</span> <span class="s2">&quot;goto frame&quot;</span><span class="p">,</span> <span class="s2">&quot;Go to Frame...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">gotoFrame</span><span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">goMenu</span><span class="p">,</span> <span class="s2">&quot;select to frame&quot;</span><span class="p">,</span> <span class="s2">&quot;Select to Frame...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">selectToFrame</span>
        <span class="p">)</span>

        <span class="c1">### View Menu ###</span>

        <span class="n">viewMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;View&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewMenu</span> <span class="o">=</span> <span class="n">viewMenu</span>  <span class="c1"># store as attribute so docks can add items</span>

        <span class="n">viewMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="n">add_menu_check_item</span><span class="p">(</span><span class="n">viewMenu</span><span class="p">,</span> <span class="s2">&quot;color predicted&quot;</span><span class="p">,</span> <span class="s2">&quot;Color Predicted Instances&quot;</span><span class="p">)</span>

        <span class="n">add_submenu_choices</span><span class="p">(</span>
            <span class="n">menu</span><span class="o">=</span><span class="n">viewMenu</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Color Palette&quot;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="o">.</span><span class="n">palette_names</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;palette&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">distinctly_color_options</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;instances&quot;</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">)</span>

        <span class="n">add_submenu_choices</span><span class="p">(</span>
            <span class="n">menu</span><span class="o">=</span><span class="n">viewMenu</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Apply Distinct Colors To&quot;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">distinctly_color_options</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;distinctly_color&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;palette&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prefs</span><span class="p">[</span><span class="s2">&quot;palette&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;distinctly_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;instances&quot;</span>

        <span class="n">viewMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="n">add_menu_check_item</span><span class="p">(</span><span class="n">viewMenu</span><span class="p">,</span> <span class="s2">&quot;show labels&quot;</span><span class="p">,</span> <span class="s2">&quot;Show Node Names&quot;</span><span class="p">)</span>
        <span class="n">add_menu_check_item</span><span class="p">(</span><span class="n">viewMenu</span><span class="p">,</span> <span class="s2">&quot;show edges&quot;</span><span class="p">,</span> <span class="s2">&quot;Show Edges&quot;</span><span class="p">)</span>

        <span class="n">add_submenu_choices</span><span class="p">(</span>
            <span class="n">menu</span><span class="o">=</span><span class="n">viewMenu</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Edge Style&quot;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Line&quot;</span><span class="p">,</span> <span class="s2">&quot;Wedge&quot;</span><span class="p">),</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;edge style&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">add_submenu_choices</span><span class="p">(</span>
            <span class="n">menu</span><span class="o">=</span><span class="n">viewMenu</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Trail Length&quot;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;trail_length&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">viewMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="n">add_menu_check_item</span><span class="p">(</span><span class="n">viewMenu</span><span class="p">,</span> <span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="s2">&quot;Fit Instances to View&quot;</span><span class="p">)</span>

        <span class="n">viewMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="n">seekbar_header_options</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;None&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Point Displacement (sum)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Point Displacement (max)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Primary Point Displacement (sum)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Primary Point Displacement (max)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Instance Score (sum)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Instance Score (min)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Point Score (sum)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Point Score (min)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Number of predicted points&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">add_submenu_choices</span><span class="p">(</span>
            <span class="n">menu</span><span class="o">=</span><span class="n">viewMenu</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Seekbar Header&quot;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">seekbar_header_options</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;seekbar_header&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;seekbar_header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;seekbar_header&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setSeekbarHeader</span><span class="p">)</span>

        <span class="n">viewMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="c1">### Label Menu ###</span>

        <span class="n">instance_adding_methods</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">best</span><span class="o">=</span><span class="s2">&quot;Best&quot;</span><span class="p">,</span>
            <span class="n">template</span><span class="o">=</span><span class="s2">&quot;Average Instance&quot;</span><span class="p">,</span>
            <span class="n">force_directed</span><span class="o">=</span><span class="s2">&quot;Force Directed&quot;</span><span class="p">,</span>
            <span class="n">random</span><span class="o">=</span><span class="s2">&quot;Random&quot;</span><span class="p">,</span>
            <span class="n">prior_frame</span><span class="o">=</span><span class="s2">&quot;Copy prior frame&quot;</span><span class="p">,</span>
            <span class="n">prediction</span><span class="o">=</span><span class="s2">&quot;Copy predictions&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">new_instance_menu_action</span><span class="p">():</span>
            <span class="n">method_key</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">key</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">instance_adding_methods</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;instance_init_method&quot;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">method_key</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">newInstance</span><span class="p">(</span><span class="n">init_method</span><span class="o">=</span><span class="n">method_key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">labelMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;Labels&quot;</span><span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">labelMenu</span><span class="p">,</span> <span class="s2">&quot;add instance&quot;</span><span class="p">,</span> <span class="s2">&quot;Add Instance&quot;</span><span class="p">,</span> <span class="n">new_instance_menu_action</span>
        <span class="p">)</span>

        <span class="n">add_submenu_choices</span><span class="p">(</span>
            <span class="n">menu</span><span class="o">=</span><span class="n">labelMenu</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Instance Placement Method&quot;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">instance_adding_methods</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;instance_init_method&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;instance_init_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance_adding_methods</span><span class="p">[</span><span class="s2">&quot;best&quot;</span><span class="p">]</span>

        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">labelMenu</span><span class="p">,</span>
            <span class="s2">&quot;delete instance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete Instance&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteSelectedInstance</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">labelMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">track_menu</span> <span class="o">=</span> <span class="n">labelMenu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;Set Instance Track&quot;</span><span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">labelMenu</span><span class="p">,</span>
            <span class="s2">&quot;transpose&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Transpose Instance Tracks&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">transposeInstance</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">labelMenu</span><span class="p">,</span>
            <span class="s2">&quot;delete track&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete Instance and Track&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteSelectedInstanceTrack</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">labelMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">labelMenu</span><span class="p">,</span>
            <span class="s2">&quot;custom delete&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Custom Instance Delete...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteDialog</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">labelMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">labelMenu</span><span class="p">,</span>
            <span class="s2">&quot;select next&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Select Next Instance&quot;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">increment_in_list</span><span class="p">(</span>
                <span class="s2">&quot;instance&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labeled_frame&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">instances_to_show</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">labelMenu</span><span class="p">,</span>
            <span class="s2">&quot;clear selection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Clear Selection&quot;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;instance&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">labelMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="c1">### Predict Menu ###</span>

        <span class="n">predictionMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;Predict&quot;</span><span class="p">)</span>

        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;training&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Run Training...&quot;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">showLearningDialog</span><span class="p">(</span><span class="s2">&quot;training&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;inference&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Run Inference...&quot;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">showLearningDialog</span><span class="p">(</span><span class="s2">&quot;inference&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">predictionMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;visualize models&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Visualize Model Outputs...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visualizeOutputs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">predictionMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;delete frame predictions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete Predictions on Current Frame&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteFramePredictions</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;delete all predictions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete All Predictions...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deletePredictions</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;delete clip predictions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete Predictions from Clip...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteClipPredictions</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;delete area predictions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete Predictions from Area...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteAreaPredictions</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;delete score predictions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete Predictions with Low Score...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteLowScorePredictions</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;delete frame limit predictions&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delete Predictions beyond Frame Limit...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteFrameLimitPredictions</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">predictionMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;export frames&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Export Training Package...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">exportDatasetWithImages</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_menu_item</span><span class="p">(</span>
            <span class="n">predictionMenu</span><span class="p">,</span>
            <span class="s2">&quot;export clip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Export Labeled Clip...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">exportLabeledClip</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1">############</span>

        <span class="n">helpMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;Help&quot;</span><span class="p">)</span>
        <span class="n">helpMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Keyboard Shortcuts&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">openKeyRef</span><span class="p">)</span>

<div class="viewcode-block" id="MainWindow.process_events_then"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.process_events_then">[docs]</a>    <span class="k">def</span> <span class="nf">process_events_then</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decorates a function with a call to first process events.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">wrapped_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="n">action</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapped_function</span></div>

    <span class="k">def</span> <span class="nf">_create_dock_windows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create dock windows and connects them to gui.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_make_dock</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">widgets</span><span class="o">=</span><span class="p">[],</span> <span class="n">tab_with</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">dock</span> <span class="o">=</span> <span class="n">QDockWidget</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">dock</span><span class="o">.</span><span class="n">setAllowedAreas</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftDockWidgetArea</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">)</span>

            <span class="n">dock_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

            <span class="n">dock_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
            <span class="n">dock</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">dock_widget</span><span class="p">)</span>

            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;hide </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2"> dock&quot;</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">prefs</span> <span class="ow">and</span> <span class="n">prefs</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="n">dock</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">addDockWidget</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightDockWidgetArea</span><span class="p">,</span> <span class="n">dock</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">dock</span><span class="o">.</span><span class="n">toggleViewAction</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">tab_with</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tabifyDockWidget</span><span class="p">(</span><span class="n">tab_with</span><span class="p">,</span> <span class="n">dock</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">layout</span>

        <span class="k">def</span> <span class="nf">_add_button</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="ow">or</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="n">to</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buttons</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">btn</span>
            <span class="k">return</span> <span class="n">btn</span>

        <span class="c1">####### Videos #######</span>
        <span class="n">videos_layout</span> <span class="o">=</span> <span class="n">_make_dock</span><span class="p">(</span><span class="s2">&quot;Videos&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">videosTable</span> <span class="o">=</span> <span class="n">GenericTableView</span><span class="p">(</span>
            <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="n">row_name</span><span class="o">=</span><span class="s2">&quot;video&quot;</span><span class="p">,</span>
            <span class="n">is_activatable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">VideosTableModel</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">videos_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">videosTable</span><span class="p">)</span>

        <span class="n">hb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;Show Video&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">videosTable</span><span class="o">.</span><span class="n">activateSelected</span><span class="p">)</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;Add Videos&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">addVideo</span><span class="p">)</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;Remove Video&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">removeVideo</span><span class="p">)</span>

        <span class="n">hbw</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">hbw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hb</span><span class="p">)</span>
        <span class="n">videos_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hbw</span><span class="p">)</span>

        <span class="c1">####### Skeleton #######</span>
        <span class="n">skeleton_layout</span> <span class="o">=</span> <span class="n">_make_dock</span><span class="p">(</span>
            <span class="s2">&quot;Skeleton&quot;</span><span class="p">,</span> <span class="n">tab_with</span><span class="o">=</span><span class="n">videos_layout</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">gb</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Nodes&quot;</span><span class="p">)</span>
        <span class="n">vb</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeletonNodesTable</span> <span class="o">=</span> <span class="n">GenericTableView</span><span class="p">(</span>
            <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="n">row_name</span><span class="o">=</span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">SkeletonNodesTableModel</span><span class="p">(</span>
                <span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">vb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skeletonNodesTable</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;New Node&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">newNode</span><span class="p">)</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;Delete Node&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteNode</span><span class="p">)</span>

        <span class="n">hbw</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">hbw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hb</span><span class="p">)</span>
        <span class="n">vb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hbw</span><span class="p">)</span>
        <span class="n">gb</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vb</span><span class="p">)</span>
        <span class="n">skeleton_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">gb</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_update_edge_src</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesDst</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">skeleton</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">]</span>

        <span class="n">gb</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s2">&quot;Edges&quot;</span><span class="p">)</span>
        <span class="n">vb</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesTable</span> <span class="o">=</span> <span class="n">GenericTableView</span><span class="p">(</span>
            <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="n">row_name</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">SkeletonEdgesTableModel</span><span class="p">(</span>
                <span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">vb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesTable</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesSrc</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesSrc</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesSrc</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">_update_edge_src</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesSrc</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">SkeletonNodeModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">]))</span>
        <span class="n">hb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesSrc</span><span class="p">)</span>
        <span class="n">hb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;to&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesDst</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesDst</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">hb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesDst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesDst</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span>
            <span class="n">SkeletonNodeModel</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">],</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesSrc</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">new_edge</span><span class="p">():</span>
            <span class="n">src_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesSrc</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="n">dst_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesDst</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">newEdge</span><span class="p">(</span><span class="n">src_node</span><span class="p">,</span> <span class="n">dst_node</span><span class="p">)</span>

        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;Add Edge&quot;</span><span class="p">,</span> <span class="n">new_edge</span><span class="p">)</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;Delete Edge&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteEdge</span><span class="p">)</span>

        <span class="n">hbw</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">hbw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hb</span><span class="p">)</span>
        <span class="n">vb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hbw</span><span class="p">)</span>
        <span class="n">gb</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vb</span><span class="p">)</span>
        <span class="n">skeleton_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">gb</span><span class="p">)</span>

        <span class="n">hb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;Load Skeleton&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">openSkeleton</span><span class="p">)</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;Save Skeleton&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">saveSkeleton</span><span class="p">)</span>

        <span class="n">hbw</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">hbw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hb</span><span class="p">)</span>
        <span class="n">skeleton_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hbw</span><span class="p">)</span>

        <span class="c1">####### Instances #######</span>
        <span class="n">instances_layout</span> <span class="o">=</span> <span class="n">_make_dock</span><span class="p">(</span><span class="s2">&quot;Instances&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instancesTable</span> <span class="o">=</span> <span class="n">GenericTableView</span><span class="p">(</span>
            <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="n">row_name</span><span class="o">=</span><span class="s2">&quot;instance&quot;</span><span class="p">,</span>
            <span class="n">name_prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">LabeledFrameTableModel</span><span class="p">(</span>
                <span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labeled_frame&quot;</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">instances_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instancesTable</span><span class="p">)</span>

        <span class="n">hb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;New Instance&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">newInstance</span><span class="p">())</span>
        <span class="n">_add_button</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="s2">&quot;Delete Instance&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">deleteSelectedInstance</span><span class="p">)</span>

        <span class="n">hbw</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">hbw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hb</span><span class="p">)</span>
        <span class="n">instances_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hbw</span><span class="p">)</span>

        <span class="c1">####### Suggestions #######</span>
        <span class="n">suggestions_layout</span> <span class="o">=</span> <span class="n">_make_dock</span><span class="p">(</span><span class="s2">&quot;Labeling Suggestions&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggestionsTable</span> <span class="o">=</span> <span class="n">GenericTableView</span><span class="p">(</span>
            <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="n">is_sortable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">SuggestionsTableModel</span><span class="p">(</span>
                <span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">suggestions</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">suggestions_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggestionsTable</span><span class="p">)</span>

        <span class="n">hb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="n">_add_button</span><span class="p">(</span>
            <span class="n">hb</span><span class="p">,</span>
            <span class="s2">&quot;Prev&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_events_then</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">prevSuggestedFrame</span><span class="p">),</span>
            <span class="s2">&quot;goto previous suggestion&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_count_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
        <span class="n">hb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_count_label</span><span class="p">)</span>

        <span class="n">_add_button</span><span class="p">(</span>
            <span class="n">hb</span><span class="p">,</span>
            <span class="s2">&quot;Next&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_events_then</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">nextSuggestedFrame</span><span class="p">),</span>
            <span class="s2">&quot;goto next suggestion&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">hbw</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">hbw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hb</span><span class="p">)</span>
        <span class="n">suggestions_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">hbw</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">suggestions_form_widget</span> <span class="o">=</span> <span class="n">YamlFormWidget</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span>
            <span class="s2">&quot;suggestions&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Generate Suggestions&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggestions_form_widget</span><span class="o">.</span><span class="n">mainAction</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_events_then</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">generateSuggestions</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">suggestions_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggestions_form_widget</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">goto_suggestion</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">selected_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggestionsTable</span><span class="o">.</span><span class="n">getSelectedRowItem</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">gotoVideoAndFrame</span><span class="p">(</span>
                <span class="n">selected_frame</span><span class="o">.</span><span class="n">video</span><span class="p">,</span> <span class="n">selected_frame</span><span class="o">.</span><span class="n">frame_idx</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">suggestionsTable</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">goto_suggestion</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;suggestion_idx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggestionsTable</span><span class="o">.</span><span class="n">selectRow</span><span class="p">)</span>

<div class="viewcode-block" id="MainWindow.load_overlays"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.load_overlays">[docs]</a>    <span class="k">def</span> <span class="nf">load_overlays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load all standard video overlays.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">[</span><span class="s2">&quot;track_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TrackListOverlay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">[</span><span class="s2">&quot;trails&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TrackTrailOverlay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">[</span><span class="s2">&quot;instance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">InstanceOverlay</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">overlay_state_connect</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">state_key</span><span class="p">,</span> <span class="n">overlay_attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">overlay_attribute</span> <span class="o">=</span> <span class="n">overlay_attribute</span> <span class="ow">or</span> <span class="n">state_key</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">state_key</span><span class="p">,</span>
                <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">overlay_attribute</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotFrame</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>

        <span class="n">overlay_state_connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">[</span><span class="s2">&quot;trails&quot;</span><span class="p">],</span> <span class="s2">&quot;trail_length&quot;</span><span class="p">)</span>

        <span class="n">overlay_state_connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="p">,</span> <span class="s2">&quot;palette&quot;</span><span class="p">)</span>
        <span class="n">overlay_state_connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="p">,</span> <span class="s2">&quot;distinctly_color&quot;</span><span class="p">)</span>
        <span class="n">overlay_state_connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="p">,</span> <span class="s2">&quot;color predicted&quot;</span><span class="p">,</span> <span class="s2">&quot;color_predicted&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;palette&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateSeekbarMarks</span><span class="p">())</span>

        <span class="c1"># update the skeleton tables since we may want to redraw colors</span>
        <span class="k">for</span> <span class="n">state_var</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;palette&quot;</span><span class="p">,</span> <span class="s2">&quot;distinctly_color&quot;</span><span class="p">,</span> <span class="s2">&quot;edge style&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">state_var</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_data_update</span><span class="p">([</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">skeleton</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="c1"># Set defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;trail_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prefs</span><span class="p">[</span><span class="s2">&quot;trail length&quot;</span><span class="p">]</span>

        <span class="c1"># Emit signals for default that may have been set earlier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;palette&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;distinctly_color&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;color predicted&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update_gui_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable/disable gui items based on current state.&quot;&quot;&quot;</span>
        <span class="n">has_selected_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;instance&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">has_selected_video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;selected_video&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">has_selected_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;selected_node&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">has_selected_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;selected_edge&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">has_frame_range</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;has_frame_range&quot;</span><span class="p">])</span>
        <span class="n">has_unsaved_changes</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;has_changes&quot;</span><span class="p">])</span>
        <span class="n">has_multiple_videos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">has_labeled_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">(</span><span class="n">lf</span><span class="o">.</span><span class="n">video</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">has_suggestions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">suggestions</span><span class="p">)</span>
        <span class="n">has_tracks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">tracks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">has_multiple_instances</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labeled_frame&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labeled_frame&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="c1"># todo: exclude predicted instances from count</span>
        <span class="n">has_nodes_selected</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesSrc</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesDst</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">control_key_down</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">queryKeyboardModifiers</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span>

        <span class="c1"># Update menus</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">track_menu</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_selected_instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;clear selection&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_selected_instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;delete instance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_selected_instance</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;delete clip predictions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_frame_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;export clip&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_frame_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;transpose&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_multiple_instances</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;save&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_unsaved_changes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;next video&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_multiple_videos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;prev video&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_multiple_videos</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;goto next labeled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_labeled_frames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;goto prev labeled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_labeled_frames</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;goto next suggestion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_suggestions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;goto prev suggestion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_suggestions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_actions</span><span class="p">[</span><span class="s2">&quot;goto next track spawn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_tracks</span><span class="p">)</span>

        <span class="c1"># Update buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buttons</span><span class="p">[</span><span class="s2">&quot;add edge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_nodes_selected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buttons</span><span class="p">[</span><span class="s2">&quot;delete edge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_selected_edge</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buttons</span><span class="p">[</span><span class="s2">&quot;delete node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_selected_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buttons</span><span class="p">[</span><span class="s2">&quot;show video&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_selected_video</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buttons</span><span class="p">[</span><span class="s2">&quot;remove video&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_selected_video</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buttons</span><span class="p">[</span><span class="s2">&quot;delete instance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">has_selected_instance</span><span class="p">)</span>

        <span class="c1"># Update overlays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">[</span><span class="s2">&quot;track_labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">control_key_down</span> <span class="ow">and</span> <span class="n">has_selected_instance</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_data_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">UpdateTopic</span><span class="p">]):</span>
        <span class="k">def</span> <span class="nf">_has_topic</span><span class="p">(</span><span class="n">topic_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">all</span> <span class="ow">in</span> <span class="n">what</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">topic_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">what</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">_has_topic</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">skeleton</span><span class="p">,</span>
                <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">project_instances</span><span class="p">,</span>
                <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">tracks</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotFrame</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">_has_topic</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">project_instances</span><span class="p">,</span>
                <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">tracks</span><span class="p">,</span>
                <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">suggestions</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateSeekbarMarks</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">_has_topic</span><span class="p">(</span>
            <span class="p">[</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">project_instances</span><span class="p">,</span> <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">tracks</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateTrackMenu</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">_has_topic</span><span class="p">([</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">video</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">videosTable</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span>

        <span class="k">if</span> <span class="n">_has_topic</span><span class="p">([</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">skeleton</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skeletonNodesTable</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesTable</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesSrc</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">skeleton</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skeletonEdgesDst</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">skeleton</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">skeletons</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">suggestions_form_widget</span><span class="o">.</span><span class="n">set_field_options</span><span class="p">(</span>
                    <span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">skeletons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">node_names</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">_has_topic</span><span class="p">([</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">on_frame</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instancesTable</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labeled_frame&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">_has_topic</span><span class="p">([</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">suggestions</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suggestionsTable</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">suggestions</span>

        <span class="k">if</span> <span class="n">_has_topic</span><span class="p">([</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">project_instances</span><span class="p">,</span> <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">suggestions</span><span class="p">]):</span>
            <span class="c1"># update count of suggested frames w/ labeled instances</span>
            <span class="n">suggestion_status_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">suggestion_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">get_suggestions</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">suggestion_list</span><span class="p">:</span>
                <span class="n">suggestion_label_counts</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">instance_count</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">video</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">frame_idx</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">suggestion_list</span>
                <span class="p">]</span>
                <span class="n">labeled_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">suggestion_list</span><span class="p">)</span> <span class="o">-</span> <span class="n">suggestion_label_counts</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">suggestion_status_text</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labeled_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">suggestion_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> labeled&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_count_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">suggestion_status_text</span><span class="p">)</span>

<div class="viewcode-block" id="MainWindow.plotFrame"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.plotFrame">[docs]</a>    <span class="k">def</span> <span class="nf">plotFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots (or replots) current frame.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_after_plot_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">frame_idx</span><span class="p">,</span> <span class="n">selected_inst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called each time a new frame is drawn.&quot;&quot;&quot;</span>

        <span class="c1"># Store the current LabeledFrame (or make new, empty object)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labeled_frame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">],</span> <span class="n">frame_idx</span><span class="p">,</span> <span class="n">return_new</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Show instances, etc, for this frame</span>
        <span class="k">for</span> <span class="n">overlay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">overlay</span><span class="o">.</span><span class="n">add_to_scene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">],</span> <span class="n">frame_idx</span><span class="p">)</span>

        <span class="c1"># Select instance if there was already selection</span>
        <span class="k">if</span> <span class="n">selected_inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">player</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">selectInstance</span><span class="p">(</span><span class="n">selected_inst</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;fit&quot;</span><span class="p">]:</span>
            <span class="n">player</span><span class="o">.</span><span class="n">zoomToFit</span><span class="p">()</span>

        <span class="c1"># Update related displays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateStatusMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_data_update</span><span class="p">([</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">on_frame</span><span class="p">])</span>

        <span class="c1"># Trigger event after the overlays have been added</span>
        <span class="n">player</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">updatedViewer</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<div class="viewcode-block" id="MainWindow.updateStatusMessage"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.updateStatusMessage">[docs]</a>    <span class="k">def</span> <span class="nf">updateStatusMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates status bar.&quot;&quot;&quot;</span>

        <span class="n">current_video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span>
        <span class="n">frame_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span>

        <span class="n">spacer</span> <span class="o">=</span> <span class="s2">&quot;        &quot;</span>

        <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Frame: </span><span class="si">{</span><span class="n">frame_idx</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">current_video</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">hasSelection</span><span class="p">():</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_range&quot;</span><span class="p">]</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (selection: </span><span class="si">{</span><span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">)&quot;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; of video </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">current_video</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacer</span><span class="si">}</span><span class="s2">Labeled Frames: &quot;</span>
            <span class="k">if</span> <span class="n">current_video</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">get_labeled_frame_count</span><span class="p">(</span><span class="n">current_video</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot; in video, &quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">project_user_frame_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">get_labeled_frame_count</span><span class="p">(</span>
                    <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;user&quot;</span>
                <span class="p">)</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">project_user_frame_count</span><span class="si">}</span><span class="s2"> in project&quot;</span>

            <span class="k">if</span> <span class="n">current_video</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pred_frame_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">get_labeled_frame_count</span><span class="p">(</span>
                    <span class="n">current_video</span><span class="p">,</span> <span class="s2">&quot;predicted&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">pred_frame_count</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacer</span><span class="si">}</span><span class="s2">Predicted Frames: </span><span class="si">{</span><span class="n">pred_frame_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">message</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">pred_frame_count</span><span class="o">/</span><span class="n">current_video</span><span class="o">.</span><span class="n">num_frames</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%)&quot;</span>
                    <span class="p">)</span>
                    <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot; in video&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.loadProjectFile"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.loadProjectFile">[docs]</a>    <span class="k">def</span> <span class="nf">loadProjectFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads given labels file into GUI.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: The path to the saved labels dataset. If None,</span>
<span class="sd">                then don&#39;t do anything.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">gui_video_callback</span> <span class="o">=</span> <span class="n">Labels</span><span class="o">.</span><span class="n">make_gui_video_callback</span><span class="p">(</span>
            <span class="n">search_paths</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="n">has_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="n">Labels</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">has_loaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">Labels</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">video_search</span><span class="o">=</span><span class="n">gui_video_callback</span><span class="p">)</span>
                <span class="n">has_loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">QMessageBox</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Unable to load </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">has_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadLabelsObject</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.loadLabelsObject"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.loadLabelsObject">[docs]</a>    <span class="k">def</span> <span class="nf">loadLabelsObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Labels</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a `Labels` object into the GUI, replacing any currently loaded.</span>

<span class="sd">        Args:</span>
<span class="sd">            labels: The `Labels` object to load.</span>
<span class="sd">            filename: The filename where this file is saved, if any.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">changestack_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;palette&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_overlays</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">skeletons</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;skeleton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">skeletons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Load first video</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">on_data_update</span><span class="p">([</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">UpdateTopic</span><span class="o">.</span><span class="n">all</span><span class="p">])</span></div>

<div class="viewcode-block" id="MainWindow.updateTrackMenu"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.updateTrackMenu">[docs]</a>    <span class="k">def</span> <span class="nf">updateTrackMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates track menu options.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_menu</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">tracks</span><span class="p">:</span>
            <span class="n">key_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">tracks</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">track</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
                <span class="n">key_command</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CTRL</span> <span class="o">+</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">tracks</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">track</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">track</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="n">track</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">setInstanceTrack</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                <span class="n">key_command</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="s2">&quot;New Track&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">addTrack</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CTRL</span> <span class="o">+</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Key_0</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.updateSeekbarMarks"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.updateSeekbarMarks">[docs]</a>    <span class="k">def</span> <span class="nf">updateSeekbarMarks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates marks on seekbar.&quot;&quot;&quot;</span>
        <span class="n">set_slider_marks_from_labels</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">seekbar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_manager</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MainWindow.setSeekbarHeader"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.setSeekbarHeader">[docs]</a>    <span class="k">def</span> <span class="nf">setSeekbarHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates graph shown in seekbar header.&quot;&quot;&quot;</span>
        <span class="n">data_obj</span> <span class="o">=</span> <span class="n">StatisticSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">header_functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Point Displacement (sum)&quot;</span><span class="p">:</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_point_displacement_series</span><span class="p">,</span>
            <span class="s2">&quot;Point Displacement (max)&quot;</span><span class="p">:</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_point_displacement_series</span><span class="p">,</span>
            <span class="s2">&quot;Primary Point Displacement (sum)&quot;</span><span class="p">:</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_primary_point_displacement_series</span><span class="p">,</span>
            <span class="s2">&quot;Primary Point Displacement (max)&quot;</span><span class="p">:</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_primary_point_displacement_series</span><span class="p">,</span>
            <span class="s2">&quot;Instance Score (sum)&quot;</span><span class="p">:</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_instance_score_series</span><span class="p">,</span>
            <span class="s2">&quot;Instance Score (min)&quot;</span><span class="p">:</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_instance_score_series</span><span class="p">,</span>
            <span class="s2">&quot;Point Score (sum)&quot;</span><span class="p">:</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_point_score_series</span><span class="p">,</span>
            <span class="s2">&quot;Point Score (min)&quot;</span><span class="p">:</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_point_score_series</span><span class="p">,</span>
            <span class="s2">&quot;Number of predicted points&quot;</span><span class="p">:</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">get_point_count_series</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">graph_name</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">clearHeader</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">graph_name</span> <span class="ow">in</span> <span class="n">header_functions</span><span class="p">:</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">video</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">])</span>
                <span class="n">reduction_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;\((sum|max|min)\)&quot;</span><span class="p">,</span> <span class="n">graph_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">reduction_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;reduction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reduction_name</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">header_functions</span><span class="p">[</span><span class="n">graph_name</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">seekbar</span><span class="o">.</span><span class="n">setHeaderSeries</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find function for </span><span class="si">{</span><span class="n">header_functions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_frames_for_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builds options for frames on which to run inference.</span>

<span class="sd">        Args:</span>
<span class="sd">            None.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionary, keys are names of options (e.g., &quot;clip&quot;, &quot;random&quot;),</span>
<span class="sd">            values are {video: list of frame indices} dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">user_labeled_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">user_labeled_frames</span>

        <span class="k">def</span> <span class="nf">remove_user_labeled</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">frame_idxs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_idxs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">frame_idxs</span>
            <span class="n">video_user_labeled_frame_idxs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">lf</span><span class="o">.</span><span class="n">frame_idx</span> <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">user_labeled_frames</span> <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">video</span> <span class="o">==</span> <span class="n">video</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">frame_idxs</span><span class="p">)</span> <span class="o">-</span> <span class="n">video_user_labeled_frame_idxs</span><span class="p">)</span>

        <span class="n">current_video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span>

        <span class="n">selection</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;frame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">current_video</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;frame_idx&quot;</span><span class="p">]]}</span>

        <span class="c1"># Use negative number in list for range (i.e., &quot;0,-123&quot; means &quot;0-123&quot;)</span>
        <span class="c1"># The ranges should be [X, Y) like standard Python ranges</span>
        <span class="n">clip_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frame_range&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">clip_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">clip_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">clip_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">clip_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;clip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">current_video</span><span class="p">:</span> <span class="n">clip_range</span><span class="p">}</span>
        <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">current_video</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">current_video</span><span class="o">.</span><span class="n">num_frames</span><span class="p">)}</span>

        <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;suggestions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">video</span><span class="p">:</span> <span class="n">remove_user_labeled</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">get_video_suggestions</span><span class="p">(</span><span class="n">video</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">video</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span>
        <span class="p">}</span>

        <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">video</span><span class="p">:</span> <span class="n">remove_user_labeled</span><span class="p">(</span>
                <span class="n">video</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">frames</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">video</span><span class="o">.</span><span class="n">frames</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">video</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;random_video&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">current_video</span><span class="p">:</span> <span class="n">remove_user_labeled</span><span class="p">(</span>
                    <span class="n">current_video</span><span class="p">,</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                        <span class="nb">range</span><span class="p">(</span><span class="n">current_video</span><span class="o">.</span><span class="n">frames</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">current_video</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">user_labeled_frames</span><span class="p">:</span>
            <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">video</span><span class="p">:</span> <span class="p">[</span><span class="n">lf</span><span class="o">.</span><span class="n">frame_idx</span> <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">user_labeled_frames</span> <span class="k">if</span> <span class="n">lf</span><span class="o">.</span><span class="n">video</span> <span class="o">==</span> <span class="n">video</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">video</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">videos</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">selection</span>

<div class="viewcode-block" id="MainWindow.showLearningDialog"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.showLearningDialog">[docs]</a>    <span class="k">def</span> <span class="nf">showLearningDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function to show learning dialog in given mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode: A string representing mode for dialog, which could be:</span>
<span class="sd">            * &quot;training&quot;</span>
<span class="sd">            * &quot;inference&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sleap.gui.learning.training</span> <span class="kn">import</span> <span class="n">LearningDialog</span>

        <span class="k">if</span> <span class="s2">&quot;inference&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;In order to use this function you must first quit and &quot;</span>
                <span class="s2">&quot;re-open SLEAP to release resources used by visualizing &quot;</span>
                <span class="s2">&quot;model outputs.&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;has_changes&quot;</span><span class="p">]:</span>
            <span class="n">QMessageBox</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;You have unsaved changes. Please save before running training or inference.&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_windows</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_child_windows</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">LearningDialog</span><span class="p">(</span>
                <span class="n">mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_child_windows</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span><span class="o">.</span><span class="n">learningFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">learningFinished</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_child_windows</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span><span class="o">.</span><span class="n">update_file_lists</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_child_windows</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span><span class="o">.</span><span class="n">frame_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frames_for_prediction</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_child_windows</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span><span class="o">.</span><span class="n">open</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindow.learningFinished"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.learningFinished">[docs]</a>    <span class="k">def</span> <span class="nf">learningFinished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called when inference finishes.&quot;&quot;&quot;</span>
        <span class="c1"># we ran inference so update display/ui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_data_update</span><span class="p">([</span><span class="n">UpdateTopic</span><span class="o">.</span><span class="n">all</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">new_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">changestack_push</span><span class="p">(</span><span class="s2">&quot;new predictions&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.visualizeOutputs"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.visualizeOutputs">[docs]</a>    <span class="k">def</span> <span class="nf">visualizeOutputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gui for adding overlay with live visualization of predictions.&quot;&quot;&quot;</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Model (*.json)&quot;</span><span class="p">]</span>

        <span class="c1"># Default to opening from models directory from project</span>
        <span class="n">models_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">models_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span> <span class="s2">&quot;models/&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Show dialog</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">selected_filter</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="nb">dir</span><span class="o">=</span><span class="n">models_dir</span><span class="p">,</span>
            <span class="n">caption</span><span class="o">=</span><span class="s2">&quot;Import model outputs...&quot;</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filters</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Model as overlay datasource</span>
        <span class="c1"># This will show live inference results</span>

        <span class="kn">from</span> <span class="nn">sleap.gui.overlays.base</span> <span class="kn">import</span> <span class="n">DataOverlay</span>

        <span class="n">overlay</span> <span class="o">=</span> <span class="n">DataOverlay</span><span class="o">.</span><span class="n">from_model</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">],</span> <span class="n">player</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">player</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">overlays</span><span class="p">[</span><span class="s2">&quot;inference&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">overlay</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindow.doubleClickInstance"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.doubleClickInstance">[docs]</a>    <span class="k">def</span> <span class="nf">doubleClickInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMouseEvent</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles when the user has double-clicked an instance.</span>

<span class="sd">        If prediction, then copy to new user-instance.</span>
<span class="sd">        If already user instance, then add any missing nodes (in case</span>
<span class="sd">        skeleton has been changed after instance was created).</span>

<span class="sd">        Args:</span>
<span class="sd">            instance: The :class:`Instance` that was double-clicked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># When a predicted instance is double-clicked, add a new instance</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">):</span>
            <span class="n">mark_complete</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Mark the nodes as &quot;complete&quot; if shift-key is down</span>
            <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ShiftModifier</span><span class="p">:</span>
                <span class="n">mark_complete</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">newInstance</span><span class="p">(</span>
                <span class="n">copy_instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span> <span class="n">mark_complete</span><span class="o">=</span><span class="n">mark_complete</span>
            <span class="p">)</span>

        <span class="c1"># When a regular instance is double-clicked, add any missing points</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">completeInstanceNodes</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.openKeyRef"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.MainWindow.openKeyRef">[docs]</a>    <span class="k">def</span> <span class="nf">openKeyRef</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shows gui for viewing/modifying keyboard shortucts.&quot;&quot;&quot;</span>
        <span class="n">ShortcutDialog</span><span class="p">()</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../_autosummary/sleap.gui.app.html#sleap.gui.app.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Starts new instance of app.&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">argparse</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;labels_path&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to labels file&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--nonnative&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Don&#39;t use native file dialogs&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">nonnative</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;USE_NON_NATIVE_FILE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">([])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setApplicationName</span><span class="p">(</span><span class="s2">&quot;SLEAP Label&quot;</span><span class="p">)</span>

    <span class="n">window</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">(</span><span class="n">labels_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">labels_path</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">showMaximized</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">labels_path</span><span class="p">:</span>
        <span class="n">window</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">openProject</span><span class="p">(</span><span class="n">first_open</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">SLEAP</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/reference.html">Feature Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019–2020, Murthy Lab @ Princeton.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>